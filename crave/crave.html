<!DOCTYPE html>
<meta charset="utf-8">
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">

<style>


body {
  font: 10px sans-serif;
}

.arc path {
  stroke: gray;
}

#ac-wrapper {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(255,255,255,.6);
  z-index: 1001;
}

#popup {
  margin: auto;
  width: 500px;
  height: 100px;
  background: #FFFFFF;
  border: 5px solid #000;
  border-radius: 25px;
  -moz-border-radius: 25px;
  -webkit-border-radius: 25px;
  box-shadow: #64686e 0px 0px 3px 3px;
  -moz-box-shadow: #64686e 0px 0px 3px 3px;
  -webkit-box-shadow: #64686e 0px 0px 3px 3px;
  position: relative;
  top: 150px; 
  text-align: center;
}

#submit_button {
  position: absolute;
  top: 20px;
  left: 20px;
}

#data_form {
  position: absolute;
  top: 50px;
  left: 20px;
}

</style>
<body>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js" ></script>  
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>

  <div id="ac-wrapper">
    <div id="popup">

      <h4>Please select a reference.</h4>

        <div class="dropdown">
          <button class="btn btn-default dropdown-toggle" type="button" id="dropdown" data-toggle="dropdown">
            Select
              <span class="caret"></span>
          </button>

          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1" id="reference_selection" style="margin: auto; left: 160px; position: absolute">
          </ul>
        </div>     

    </div>
  </div>

  <div id="page_content">
    <button type="button" class="btn btn-default btn-sm" id="submit_button">Submit</button>
    
    <form id="data_form">
    </form>
 
  </div>

<script>

function PopUp(){
  document.getElementById('ac-wrapper').style.display="none"; 
}

$(document).ready(function(){
    d3.csv("bed_file.csv", function(error, data) {

      var column_names;

      data.forEach(function(d) {
        column_names = Object.keys(d)
      });

      column_names = column_names.splice(4)


      var dropdown = document.getElementById("reference_selection");

      for (var i = 0; i < column_names.length; i++) {

        var opt = column_names[i];
        var li = document.createElement("li");
        var link = document.createElement("a");
        var text = document.createTextNode(opt);
        link.appendChild(text);
        link.href = "#";
        li.appendChild(link);
        dropdown.appendChild(li);

      }

    $(".dropdown-menu li a").click( function() {
      var selected_Text = $(this).text();

      for (var i = 0; i < column_names.length; i++) {
        if (column_names[i] == selected_Text) {
          column_names.splice(i,1);
        }
      }

      for (var i = 0; i < column_names.length; i++) {

        $("#data_form").append('<input type="checkbox" name="file_pick" value=' + column_names[i] + " id=" + column_names[i] + ">"+ column_names[i] + "<br>")

      }

      PopUp();

    });

  })

});

var width = 1250,
    height = 1100,
    radius = Math.min(width, height) / 2.3;

var arc = d3.svg.arc()
    .outerRadius(radius - 10)
    .innerRadius(radius - 70);

var pie = d3.layout.pie()
    .sort(null)
    .value(function(d) { return d.start; });

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height)
  .append("g")
    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

d3.select("#submit_button")
  .on("click", function() {

    var num_checked = $('#data_form :checkbox:checked').length;

    //console.log("here")
    return draw(num_checked);
  });

function draw(num_checked) {

  //console.log(num_checked)

  d3.selectAll(".arc").remove();
  d3.selectAll(".wedge").remove();

  if (num_checked > 0) {

    //console.log(num_checked)

    var all_values = []

    $('#data_form :checked').each(function() {
      all_values.push($(this).val());
    });

    d3.csv("bed_file.csv", function(error, data) {

      data.forEach(function(d) {
        d.start = +d.start;
        d.overlap = +d.overlap;
        d.A = +d.A;
        d.B = +d.B;
        d.C = +d.C;

        //console.log(Object.keys(d))
      });

      var g = svg.selectAll(".arc")
          .data(pie(data))
        .enter().append("g")
          .attr("class", "arc");

      g.append("path")
          .attr("d", arc)
          .attr("class", "wedge")
          .style("fill", function(d) {
            //console.log("here")
            if (d.data.overlap == 1) {
              return "green";
            }
            else {
              return "white";
            }
          });

      for (var i = 1; i < num_checked; i++) {

        var inner_arc = d3.svg.arc()
          .outerRadius(radius - (i*100) - 10)
          .innerRadius(radius - (i*100) - 70)

        g.append("path")
          .attr("d", inner_arc)
          .attr("clas", "wedge")
          .style("fill", function(d) {
            if (d.data[all_values[i]] == 1) {
              return "green";
            }
            else {
              return "white";
            }
          })
      }

    });

  }
}

</script>